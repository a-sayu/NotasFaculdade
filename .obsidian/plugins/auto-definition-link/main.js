var __defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropNames=Object.getOwnPropertyNames,__hasOwnProp=Object.prototype.hasOwnProperty,__export=(target,all)=>{for(var name in all)__defProp(target,name,{get:all[name],enumerable:!0})},__copyProps=(to,from,except,desc)=>{if(from&&"object"==typeof from||"function"==typeof from)for(let key of __getOwnPropNames(from))__hasOwnProp.call(to,key)||key===except||__defProp(to,key,{get:()=>from[key],enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable});return to},__toCommonJS=mod=>__copyProps(__defProp({},"__esModule",{value:!0}),mod),main_exports={},import_state=(__export(main_exports,{default:()=>AutoDefinitionLink}),module.exports=__toCommonJS(main_exports),require("@codemirror/state")),import_view=require("@codemirror/view"),import_obsidian=require("obsidian"),step2list={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},step3list={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},consonant="[^aeiou]",vowel="[aeiouy]",consonants="("+consonant+"[^aeiouy]*)",vowels="("+vowel+"[aeiou]*)",gt0=new RegExp("^"+consonants+"?"+vowels+consonants),eq1=new RegExp("^"+consonants+"?"+vowels+consonants+vowels+"?$"),gt1=new RegExp("^"+consonants+"?("+vowels+consonants+"){2,}"),vowelInStem=new RegExp("^"+consonants+"?"+vowel),consonantLike=new RegExp("^"+consonants+vowel+"[^aeiouwxy]$"),sfxLl=/ll$/,sfxE=/^(.+?)e$/,sfxY=/^(.+?)y$/,sfxIon=/^(.+?(s|t))(ion)$/,sfxEdOrIng=/^(.+?)(ed|ing)$/,sfxAtOrBlOrIz=/(at|bl|iz)$/,sfxEED=/^(.+?)eed$/,sfxS=/^.+?[^s]s$/,sfxSsesOrIes=/^.+?(ss|i)es$/,sfxMultiConsonantLike=/([^aeiouylsz])\1$/,step2=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/,step3=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/,step4=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/;function stemmer(value){let result=String(value).toLowerCase();if(!(result.length<3)){let firstCharacterWasLowerCaseY=!1;121===result.codePointAt(0)&&(firstCharacterWasLowerCaseY=!0,result="Y"+result.slice(1)),sfxSsesOrIes.test(result)?result=result.slice(0,-2):sfxS.test(result)&&(result=result.slice(0,-1));let match;(match=sfxEED.exec(result))?gt0.test(match[1])&&(result=result.slice(0,-1)):(match=sfxEdOrIng.exec(result))&&vowelInStem.test(match[1])&&(result=match[1],sfxAtOrBlOrIz.test(result)?result+="e":sfxMultiConsonantLike.test(result)?result=result.slice(0,-1):consonantLike.test(result)&&(result+="e")),(match=sfxY.exec(result))&&vowelInStem.test(match[1])&&(result=match[1]+"i"),(match=step2.exec(result))&&gt0.test(match[1])&&(result=match[1]+step2list[match[2]]),(match=step3.exec(result))&&gt0.test(match[1])&&(result=match[1]+step3list[match[2]]),(match=step4.exec(result))?gt1.test(match[1])&&(result=match[1]):(match=sfxIon.exec(result))&&gt1.test(match[1])&&(result=match[1]),(match=sfxE.exec(result))&&(gt1.test(match[1])||eq1.test(match[1])&&!consonantLike.test(match[1]))&&(result=match[1]),sfxLl.test(result)&&gt1.test(result)&&(result=result.slice(0,-1)),firstCharacterWasLowerCaseY&&(result="y"+result.slice(1))}return result}var TERMSPLITTERS=/[^a-zA-Z0-9]/g,BLOCKIDREGEX=/(?: |^)\^([a-zA-Z0-9-]+$)/gm,YAMLREGEX=/---\n((?:.|\n)*?)\n---/gm,VALIDINTERRUPTERS=/^[^a-zA-Z-0-9]$/;function internalLinkElement(linkPath,text){var element=document.createElement("a");return element.dataset.tooltipPosition="top",element.setAttribute("aria-label",linkPath),element.setAttribute("data-href",linkPath),element.href=linkPath,element.classList.add("internal-link"),element.target="_blank",element.rel="noopener",element.innerText=text,element}function findSuggestionsInText(text){var indices=Array.from(text.matchAll(TERMSPLITTERS)).map(match=>{return null!=(match=match.index)?match:0});indices.push(text.length),indices.reverse();const suggestionsToAdd=[],blockedIndexIndices=[];return indices.forEach((i,indexOfIndex)=>{var suggestions=AutoDefinitionLink.getSuggestions(text.slice(0,i),{line:0,ch:0});if(suggestions.length){var suggestion=suggestions[0];if(!blockedIndexIndices.includes(indexOfIndex)){for(let j=1;j<suggestion.linkDestination.numTerms;j++)blockedIndexIndices.includes(indexOfIndex+j)||blockedIndexIndices.push(indexOfIndex+j);suggestionsToAdd.push({suggestion:suggestion,from:i-suggestion.text.length,to:i})}}}),suggestionsToAdd.reverse()}function retrieveAliasesFromContent(contents){contents=Array.from(contents.matchAll(YAMLREGEX));if(contents&&0!==contents.length&&!(contents[0].length<2)){contents=(0,import_obsidian.parseYaml)(contents[0][1]).aliases;if(contents)return contents}}function retrieveBlockMatchesFromContent(contents){contents=contents.matchAll(BLOCKIDREGEX);return Array.from(contents).map(match=>match[1])}function lemmatizeIfEnabled(term){return AutoDefinitionLink.settings.lemmatizeTerms?stemmer(term):term}function normalizeId(id){return id.toLowerCase().split(TERMSPLITTERS).map(word=>lemmatizeIfEnabled(word)).join("-")}var LinkWidget=class extends import_view.WidgetType{constructor(href,text){super(),this.href=href,this.text=text}toDOM(view){return internalLinkElement(this.href,this.text)}},AutoDefinitionLinkEditorExtension=class{constructor(view){this.decorations=this.buildDecorations(view)}update(update){AutoDefinitionLink.settings.realTimeLinking&&(update.docChanged||update.viewportChanged||update.selectionSet)&&(this.decorations=this.buildDecorations(update.view))}destroy(){}buildDecorations(view){const builder=new import_state.RangeSetBuilder,state=view.state;for(let curLineNumber=1;curLineNumber<=state.doc.lines;curLineNumber++){const curLine=state.doc.line(curLineNumber);findSuggestionsInText(curLine.text).forEach(suggestion=>{builder.add(suggestion.from+curLine.from,suggestion.to+curLine.from,state.selection.main.from<=curLine.to&&state.selection.main.to>=curLine.from?import_view.Decoration.mark({attributes:{style:"text-decoration: underline; text-decoration-color: #55f; text-decoration-thickness: 3px;"}}):import_view.Decoration.replace({widget:new LinkWidget(suggestion.suggestion.linkDestination.linkPath,suggestion.suggestion.text)}))})}return builder.finish()}},pluginSpec={decorations:value=>value.decorations},autoDefinitionLinkEditorExtension=import_view.ViewPlugin.fromClass(AutoDefinitionLinkEditorExtension,pluginSpec),import_obsidian5=require("obsidian"),import_obsidian2=require("obsidian"),_updateBlockIds=(0,import_obsidian2.debounce)(updateBlockIds,2e3);async function updateBlockIds(app,editor){try{if(!AutoDefinitionLink.isUpdatingBlockIds){AutoDefinitionLink.isUpdatingBlockIds=!0,AutoDefinitionLink.statusBarEl.setText("Searching files...");const startTime=Date.now();let maxNumTerms=0;const linkDestinations=[],processFileContents=(contents,path)=>{var blockMatches;(blockMatches=retrieveBlockMatchesFromContent(contents))&&linkDestinations.push(...blockMatches.map(match=>{var blockNumTerms=match.split(TERMSPLITTERS).length;return blockNumTerms>maxNumTerms&&(maxNumTerms=blockNumTerms),{linkPath:path+"#^"+match,searchValue:normalizeId(match),numTerms:blockNumTerms}})),(blockMatches=retrieveAliasesFromContent(contents))&&linkDestinations.push(...blockMatches.map(alias=>{var aliasNumTerms=alias.split(TERMSPLITTERS).length;return aliasNumTerms>maxNumTerms&&(maxNumTerms=aliasNumTerms),{linkPath:path,searchValue:normalizeId(alias),numTerms:aliasNumTerms}}))},activeFile=app.workspace.getActiveFile(),files=app.vault.getMarkdownFiles(),fileProcessingPromises=[];let filesProcessed=0;const incrementStatusBar=()=>{filesProcessed++;var timeEstimate=(Math.round((Date.now()-startTime)/filesProcessed*(files.length-filesProcessed)/10)/100).toFixed(2);AutoDefinitionLink.statusBarEl.setText(`Searching files... ${filesProcessed}/${files.length} processed (${timeEstimate}s)`)};files.forEach((file,i)=>{fileProcessingPromises.push(new Promise(resolve=>{var fileNameNumTerms=file.basename.split(TERMSPLITTERS).length;return fileNameNumTerms>maxNumTerms&&(maxNumTerms=fileNameNumTerms),linkDestinations.push({linkPath:file.path,searchValue:normalizeId(file.basename),numTerms:fileNameNumTerms}),AutoDefinitionLink.settings.searchFileContent?file.path==(null==activeFile?void 0:activeFile.path)?(processFileContents(editor.getValue(),file.path),incrementStatusBar(),resolve(0)):void app.vault.cachedRead(file).then(contents=>(processFileContents(contents,file.path),incrementStatusBar(),resolve(0))):(incrementStatusBar(),resolve(0))}))}),await Promise.all(fileProcessingPromises),AutoDefinitionLink.statusBarEl.setText("Indexing link database..."),AutoDefinitionLink.linkDestinations=linkDestinations.sort((a,b)=>a.numTerms===b.numTerms?a.searchValue<b.searchValue?-1:a.searchValue>b.searchValue?1:0:a.numTerms-b.numTerms),AutoDefinitionLink.maxNumTerms=maxNumTerms,AutoDefinitionLink.linkDestinationsNumTermsRanges={};let currentNumTerms=0;for(;currentNumTerms<=AutoDefinitionLink.maxNumTerms;){var startIndex=AutoDefinitionLink.linkDestinations.findIndex(linkDestination=>linkDestination.numTerms===currentNumTerms);let endIndex=AutoDefinitionLink.linkDestinations.findIndex(linkDestination=>linkDestination.numTerms>currentNumTerms)-1;-1===startIndex?currentNumTerms++:(-2===endIndex&&(endIndex=AutoDefinitionLink.linkDestinations.length-1),AutoDefinitionLink.linkDestinationsNumTermsRanges[currentNumTerms]={start:startIndex,end:endIndex},currentNumTerms++)}AutoDefinitionLink.statusBarEl.setText(`Updated block ids in ${Date.now()-startTime}ms`),app.workspace.iterateAllLeaves(leaf=>{leaf.view instanceof import_obsidian2.MarkdownView&&leaf.view.editor.setCursor(leaf.view.editor.getCursor())})}}catch(e){console.error(e),AutoDefinitionLink.statusBarEl.setText("Error updating block ids")}finally{AutoDefinitionLink.isUpdatingBlockIds=!1}}var import_obsidian3=require("obsidian"),AutoDefinitionLinkSuggest=class extends import_obsidian3.EditorSuggest{constructor(app){super(app)}async getSuggestions(context){return AutoDefinitionLink.getSuggestions(context.query,context.editor.getCursor())}onTrigger(cursor,editor,file){var originalLine,textBeforeCursor,carrotIndex;return!AutoDefinitionLink.settings.useSuggestions||0===AutoDefinitionLink.linkDestinations.length||0===(originalLine=editor.getLine(cursor.line)).length?null:(textBeforeCursor=originalLine.slice(0,cursor.ch),-1!==(carrotIndex=originalLine.indexOf(" ^"))&&originalLine.slice(carrotIndex,cursor.ch).match(BLOCKIDREGEX)?(_updateBlockIds(this.app,editor),null):{start:cursor,end:cursor,query:textBeforeCursor||""})}renderSuggestion(item,el){el.setText(item.linkDestination.linkPath)}selectSuggestion(item,evt){this.close();var _a=null==(_a=this.app.workspace.activeEditor)?void 0:_a.editor;_a&&AutoDefinitionLink.replaceSuggestion(item,_a)}},import_obsidian4=require("obsidian"),DEFAULT_SETTINGS={useSuggestions:!1,useAutoLink:!1,searchFileContent:!0,subFolderDepth:-1,realTimeLinking:!0,autoRefreshLinks:"always",lemmatizeTerms:!0,autoLoadRealTimeBacklinks:!0},AutoDefinitionLinkSettingTab=class extends import_obsidian4.PluginSettingTab{constructor(app,plugin){super(app,plugin),this.plugin=plugin}display(){var containerEl=this["containerEl"];containerEl.empty(),new import_obsidian4.Setting(containerEl).setName("Use suggestions").setDesc("If disabled, the plugin will not suggest links to replace block ids with").addToggle(toggle=>{toggle.setValue(AutoDefinitionLink.settings.useSuggestions).onChange(async value=>{AutoDefinitionLink.settings.useSuggestions=value,await this.plugin.saveSettings()})}),new import_obsidian4.Setting(containerEl).setName("Use auto link").setDesc("If disabled, the plugin will not automatically convert a block id to a link after pressing space (or another valid interrupter)").addToggle(toggle=>{toggle.setValue(AutoDefinitionLink.settings.useAutoLink).onChange(async value=>{AutoDefinitionLink.settings.useAutoLink=value,await this.plugin.saveSettings()})}),new import_obsidian4.Setting(containerEl).setName("Lemmatize Terms").setDesc("Lemmatize terms in the search value. This will make the search value more flexible, but may also make it less accurate.").addToggle(toggle=>{toggle.setValue(AutoDefinitionLink.settings.lemmatizeTerms).onChange(async value=>{AutoDefinitionLink.settings.lemmatizeTerms=value,await this.plugin.saveSettings()})}),new import_obsidian4.Setting(containerEl).setName("Search file content").setDesc("If disabled, the plugin will only use the names of files and not the contents of files to find links (disabling will disable aliases in results). If you are having performance issues, DISABLE THIS.").addToggle(toggle=>{toggle.setValue(AutoDefinitionLink.settings.searchFileContent).onChange(async value=>{AutoDefinitionLink.settings.searchFileContent=value,await this.plugin.saveSettings()})}),new import_obsidian4.Setting(containerEl).setName("Real-time linking").setDesc("If enabled, the plugin will automatically show links without having to be suggested them. This means old files will link to new files without modifications. This may cause performance issues, however it has been tested with ~20K files and runs with <0ms latency. (May require reload after disabling)").addToggle(toggle=>{toggle.setValue(AutoDefinitionLink.settings.realTimeLinking).onChange(async value=>{AutoDefinitionLink.settings.realTimeLinking=value,await this.plugin.saveSettings()})}),new import_obsidian4.Setting(containerEl).setName("Auto load real-time backlinks").setDesc("If enabled, the plugin will automatically load backlinks when a new file is opened. This may make files feel sluggish to open, and only applies to real-time linking.").addToggle(toggle=>{toggle.setValue(AutoDefinitionLink.settings.autoLoadRealTimeBacklinks).onChange(async value=>{AutoDefinitionLink.settings.autoLoadRealTimeBacklinks=value,await this.plugin.saveSettings()})}),new import_obsidian4.Setting(containerEl).setName("Auto-refresh links").setDesc("If enabled, the plugin will automatically refresh links when the vault is opened or a file is renamed, edited, deleted, or modified. This may take a couple of seconds (runs in background).").addDropdown(dropdown=>{dropdown.addOption("always","Always"),dropdown.addOption("main","Create/rename/delete"),dropdown.addOption("never","Never"),dropdown.setValue(AutoDefinitionLink.settings.autoRefreshLinks).onChange(async value=>{AutoDefinitionLink.settings.autoRefreshLinks=value,await this.plugin.saveSettings()})}),new import_obsidian4.Setting(containerEl).setName("Refresh links").setDesc("Refreshes the links in the current vault. This may take a couple of seconds.").addButton(button=>{button.setButtonText("Refresh links").onClick(async()=>{var _a=null==(_a=this.app.workspace.activeEditor)?void 0:_a.editor;_a&&updateBlockIds(this.app,_a)})})}};function getBackLinks(app){return new Promise(resolveWithBackLinks=>{const ids=[(null==(_a=null==(_a=app.workspace.activeEditor)?void 0:_a.file)?void 0:_a.basename)||"",...retrieveBlockMatchesFromContent(null!=(_a=null==(_a=null==(_a=app.workspace.activeEditor)?void 0:_a.editor)?void 0:_a.getValue())?_a:"")||[],...retrieveAliasesFromContent(null!=(_a=null==(_a=null==(_a=app.workspace.activeEditor)?void 0:_a.editor)?void 0:_a.getValue())?_a:"")||[]].map(normalizeId);var _a=app.vault.getMarkdownFiles();const fileSearchPromises=[],filesWithSuggestions=[];_a.forEach(file=>{var _a2;file!==(null==(_a2=app.workspace.activeEditor)?void 0:_a2.file)&&fileSearchPromises.push(new Promise(resolve=>{app.vault.cachedRead(file).then(contents=>{contents.split("\n").forEach(line=>{filesWithSuggestions.includes(file)||findSuggestionsInText(line).filter(x=>ids.contains(x.suggestion.linkDestination.searchValue)).length&&filesWithSuggestions.push(file)}),resolve()})}))}),Promise.all(fileSearchPromises).then(()=>{resolveWithBackLinks(filesWithSuggestions)})})}function autoDefinitionLinkPostProcessor(el,ctx,app){if(AutoDefinitionLink.settings.realTimeLinking){const footerObserver=new MutationObserver(mutations=>{var footerElement=Array.from(document.querySelectorAll(".mod-footer")).filter(footer=>{var _a;return null==(_a=el.parentElement)?void 0:_a.contains(footer)})[0],headerElement=Array.from(document.querySelectorAll(".mod-header")).filter(header=>{var _a;return null==(_a=el.parentElement)?void 0:_a.contains(header)})[0];footerElement&&headerElement&&(footerObserver.disconnect(),el.matches(".mod-header + div"))&&((headerElement=footerElement.querySelector('div[is-backlinks="true"]'))?populateBacklinkDivFirstTime(headerElement):((headerElement=document.createElement("div")).style.display="flex",headerElement.style.flexWrap="wrap",headerElement.style.justifyContent="center",headerElement.style.alignItems="center",headerElement.style.margin="1em 0",headerElement.style.marginTop="5em",headerElement.style.padding=".8em",headerElement.style.border="1px solid #5555ff30",headerElement.style.borderRadius="1em",headerElement.style.backgroundColor="#5555ff10",headerElement.style.width="100%",headerElement.style.maxWidth="100%",headerElement.style.overflow="hidden",headerElement.style.textOverflow="ellipsis",headerElement.style.whiteSpace="nowrap",headerElement.style.fontFamily="var(--font-monospace)",headerElement.style.fontSize=".8em",headerElement.style.lineHeight="var(--line-height-small)",headerElement.style.color="#000000",headerElement.setAttribute("is-backlinks","true"),populateBacklinkDivFirstTime(headerElement=headerElement),footerElement.appendChild(headerElement)))});footerObserver.observe(document.body,{childList:!0,subtree:!0}),setTimeout(()=>footerObserver.disconnect(),5e3);var textMap=function getTextRecursively(element){let texts={};return Array.from(element.childNodes).forEach(child=>{if(!(child instanceof HTMLElement&&child.hasClass("internal-link")))return child.nodeType===Node.TEXT_NODE?child.textContent?texts[child.textContent]=child:void 0:void(child instanceof HTMLElement&&(texts={...texts,...getTextRecursively(child)}))}),texts}(el);function populateBacklinkDivFirstTime(div){AutoDefinitionLink.settings.autoLoadRealTimeBacklinks?getBackLinks(app).then(backlinks=>{populateBacklinkDiv(div,backlinks,!0)}):populateBacklinkDiv(div,[],!0)}function populateBacklinkDiv(div,backlinks,unLoaded=!1){for(;div.firstChild;)div.removeChild(div.firstChild);backlinks.length?backlinks.map(file=>internalLinkElement(file.path,file.basename)).forEach(link=>{link.style.padding=".2em 1.2em",link.style.margin=".2em",link.style.background="#5555ff30",link.style.borderRadius="1em",link.style.textDecoration="none",div.appendChild(link)}):div.appendChild(document.createTextNode(unLoaded?"Press to load backlinks...":"No backlinks")),div.appendChild(function(div){var reloadButton=document.createElement("button");return reloadButton.textContent="↻",reloadButton.style.margin=".2em",reloadButton.style.padding=".2em 1em",reloadButton.style.border="none",reloadButton.style.background="#5555ff30",reloadButton.style.borderRadius="1em",reloadButton.style.cursor="pointer",reloadButton.style.fontSize="1em",reloadButton.style.fontWeight="bold",reloadButton.style.color="#000000",reloadButton.style.textDecoration="none",reloadButton.style.marginLeft="auto",reloadButton.onclick=()=>{getBackLinks(app).then(backlinks=>{populateBacklinkDiv(div,backlinks)})},reloadButton}(div))}Object.entries(textMap).forEach(([text,element])=>{findSuggestionsInText(text).reverse().forEach(suggestion=>{var _a=null!=(_a=null==(_a=element.textContent)?void 0:_a.slice(0,suggestion.from))?_a:"",_c=null!=(_c=null==(_c=element.textContent)?void 0:_c.slice(suggestion.to))?_c:"",_a=(element.nodeValue=_a,null==(_a=element.parentNode)?void 0:_a.insertAfter(internalLinkElement(suggestion.suggestion.linkDestination.linkPath,suggestion.suggestion.text),element));if(!_a)throw new Error("newLinkNode is null");null!=(suggestion=element.parentNode)&&suggestion.insertAfter(document.createTextNode(_c),_a)})})}}var _AutoDefinitionLink=class extends import_obsidian5.Plugin{static binarySearchLinkDestinations(searchValue,numTerms){var _a,_e,_f;let start=null!=(_a=null==(_a=_AutoDefinitionLink.linkDestinationsNumTermsRanges[numTerms])?void 0:_a.start)?_a:0,end=null!=(numTerms=null==(_a=_AutoDefinitionLink.linkDestinationsNumTermsRanges[numTerms])?void 0:_a.end)?numTerms:0;for(;start<=end;){var mid=Math.floor((start+end)/2);if(_AutoDefinitionLink.linkDestinations[mid].searchValue===searchValue){let earliestMatchingLinkDestinationIndex=mid,latestMatchingLinkDestinationIndex=mid;for(;(null==(_e=_AutoDefinitionLink.linkDestinations[earliestMatchingLinkDestinationIndex-1])?void 0:_e.searchValue)===searchValue;)earliestMatchingLinkDestinationIndex-=1;for(;(null==(_f=_AutoDefinitionLink.linkDestinations[latestMatchingLinkDestinationIndex+1])?void 0:_f.searchValue)===searchValue;)latestMatchingLinkDestinationIndex+=1;return _AutoDefinitionLink.linkDestinations.slice(earliestMatchingLinkDestinationIndex,latestMatchingLinkDestinationIndex+1)}_AutoDefinitionLink.linkDestinations[mid].searchValue<searchValue?start=mid+1:end=mid-1}return null}static replaceSuggestion(suggestion,editor){editor.replaceRange(`[[${suggestion.linkDestination.linkPath}|${suggestion.text}]]`,{line:suggestion.cursor.line,ch:suggestion.cursor.ch-suggestion.text.length},suggestion.cursor)}static getSuggestions(query,cursor){var suggestions=[];for(let i=_AutoDefinitionLink.maxNumTerms;1<=i;i--){var substrLen=query.split(TERMSPLITTERS).slice(-i).reduce((acc,curr)=>acc+curr.length,0)+i-1;const substr=query.split("").slice(-substrLen).join("");substrLen=normalizeId(substr),substrLen=_AutoDefinitionLink.binarySearchLinkDestinations(substrLen,i);null!=substrLen&&substrLen.length&&suggestions.push(...substrLen.map(linkDestination=>({text:substr,linkDestination:linkDestination,cursor:cursor})))}return suggestions}async onload(){_AutoDefinitionLink.statusBarEl=this.addStatusBarItem().createEl("span",{text:"Starting up..."}),await this.loadSettings();var refreshButton=this.addStatusBarItem(),refreshButton=(refreshButton.addClass("mod-clickable"),refreshButton.createEl("span",{text:"↻"}),refreshButton.onclick=()=>{var _a2=null==(_a2=this.app.workspace.activeEditor)?void 0:_a2.editor;_a2&&updateBlockIds(this.app,_a2)},this.addCommand({id:"refresh-block-ids",name:"Refresh links",callback:()=>{var _a2=null==(_a2=this.app.workspace.activeEditor)?void 0:_a2.editor;_a2&&updateBlockIds(this.app,_a2)}}),null==(refreshButton=this.app.workspace.activeEditor)?void 0:refreshButton.editor),refreshButton=(refreshButton&&updateBlockIds(this.app,refreshButton),new AutoDefinitionLinkSuggest(this.app));this.registerEditorSuggest(refreshButton),this.registerEvent(this.app.vault.on("create",file=>{var _a2;"never"!==_AutoDefinitionLink.settings.autoRefreshLinks&&(_a2=null==(_a2=this.app.workspace.activeEditor)?void 0:_a2.editor)&&updateBlockIds(this.app,_a2)})),this.registerEvent(this.app.vault.on("delete",file=>{var _a2;"never"!==_AutoDefinitionLink.settings.autoRefreshLinks&&(_a2=null==(_a2=this.app.workspace.activeEditor)?void 0:_a2.editor)&&updateBlockIds(this.app,_a2)})),this.registerEvent(this.app.vault.on("rename",file=>{var _a2;"never"!==_AutoDefinitionLink.settings.autoRefreshLinks&&(_a2=null==(_a2=this.app.workspace.activeEditor)?void 0:_a2.editor)&&updateBlockIds(this.app,_a2)})),this.registerEvent(this.app.vault.on("modify",file=>{var _a2;"always"===_AutoDefinitionLink.settings.autoRefreshLinks&&(_a2=null==(_a2=this.app.workspace.activeEditor)?void 0:_a2.editor)&&_updateBlockIds(this.app,_a2)})),this.registerMarkdownPostProcessor((el,ctx)=>autoDefinitionLinkPostProcessor(el,ctx,this.app)),this.registerDomEvent(document,"keydown",evt=>{this.lastKey=evt.key,this.lastKeyShift=evt.shiftKey}),this.registerEvent(this.app.workspace.on("editor-change",editor2=>{var cursorPosBeforeSpace,originalLine,cursorPos,carrotIndex;_AutoDefinitionLink.settings.useAutoLink&&(cursorPosBeforeSpace={line:(cursorPos=editor2.getCursor()).line,ch:cursorPos.ch-1},0!==(originalLine=editor2.getLine(cursorPos.line)).length)&&(-1!==(carrotIndex=originalLine.indexOf(" ^"))&&originalLine.slice(carrotIndex,cursorPos.ch).match(BLOCKIDREGEX)?_updateBlockIds(this.app,editor2):null==(carrotIndex=this.lastKey)||!carrotIndex.match(VALIDINTERRUPTERS)||this.lastKeyShift&&" "===this.lastKey||0!==_AutoDefinitionLink.linkDestinations.length&&(cursorPos=originalLine.substring(0,cursorPosBeforeSpace.ch)||"",null!=(carrotIndex=_AutoDefinitionLink.getSuggestions(cursorPos,cursorPosBeforeSpace)))&&carrotIndex.length&&_AutoDefinitionLink.replaceSuggestion(carrotIndex[0],editor2))})),this.addSettingTab(new AutoDefinitionLinkSettingTab(this.app,this)),this.registerEditorExtension(autoDefinitionLinkEditorExtension)}async loadSettings(){_AutoDefinitionLink.settings=Object.assign({},DEFAULT_SETTINGS,await this.loadData())}async saveSettings(){await this.saveData(_AutoDefinitionLink.settings)}},AutoDefinitionLink=_AutoDefinitionLink;AutoDefinitionLink.linkDestinations=[],AutoDefinitionLink.maxNumTerms=0,AutoDefinitionLink.linkDestinationsNumTermsRanges={},AutoDefinitionLink.isUpdatingBlockIds=!1;
/* nosourcemap */