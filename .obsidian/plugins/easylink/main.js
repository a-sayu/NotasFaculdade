/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var b=Object.defineProperty;var x=Object.getOwnPropertyDescriptor;var P=Object.getOwnPropertyNames;var R=Object.prototype.hasOwnProperty;var I=(u,h)=>{for(var e in h)b(u,e,{get:h[e],enumerable:!0})},L=(u,h,e,t)=>{if(h&&typeof h=="object"||typeof h=="function")for(let s of P(h))!R.call(u,s)&&s!==e&&b(u,s,{get:()=>h[s],enumerable:!(t=x(h,s))||t.enumerable});return u};var D=u=>L(b({},"__esModule",{value:!0}),u);var M={};I(M,{default:()=>y});module.exports=D(M);var i=require("obsidian"),F=new Set(["i","me","my","myself","we","our","ours","he","him","his","she","her","it","its","they","them","their","what","which","who","this","that","these","those","am","is","are","was","were","be","been","a","an","the","and","but","if","or","as","of","at","by","for","with","to","from","in","out","on","off"]),N=new Set(["\uC774","\uAC00","\uC740","\uB294","\uC744","\uB97C","\uC758","\uC5D0","\uC5D0\uC11C","\uC640","\uACFC","\uB3C4","\uC73C\uB85C","\uB85C","\uB9CC","\uBFD0","\uADF8\uB9AC\uACE0","\uADF8\uB798\uC11C","\uADF8\uB7EC\uB098","\uD558\uC9C0\uB9CC","\uADF8","\uC800","\uAC83","\uC218","\uB54C","\uACF3","\uB4E4"]),A=new Set([...F,...N]),$={foldersToIgnore:[],maxResults:25,minScore:.1,useDefaultStopwords:!0,customStopwords:[],searchCurrentFile:!1},y=class extends i.Plugin{constructor(){super(...arguments);this.isSearching=!1}async onload(){await this.loadSettings(),this.updateStopwords(),this.addRibbonIcon("link","EasyLink: Find similar notes",()=>this.triggerSearch()),this.addCommand({id:"find-similar-content",name:"Find similar content for selection",editorCallback:e=>this.triggerSearch(e)}),this.addSettingTab(new v(this.app,this)),this.registerEvent(this.app.workspace.on("editor-menu",(e,t)=>{t.getSelection()&&e.addItem(s=>{s.setTitle("EasyLink: Find similar content").setIcon("link").onClick(()=>this.triggerSearch(t))})}))}triggerSearch(e){let t=e||this.app.workspace.activeEditor?.editor;if(t){let s=t.getSelection();s.trim()!==""?this.findAndShowSimilarContent(s,t):new i.Notice("Please select text to find similar notes.")}else new i.Notice("Please open a note and select text first.")}async saveSettings(){await this.saveData(this.settings),this.updateStopwords()}updateStopwords(){let e=new Set(this.settings.customStopwords);this.combinedStopwords=this.settings.useDefaultStopwords?new Set([...A,...e]):e}async loadSettings(){this.settings=Object.assign({},$,await this.loadData())}async findAndShowSimilarContent(e,t){if(this.isSearching){new i.Notice("A search is already in progress.");return}this.isSearching=!0;let s=null,r=setTimeout(()=>{s=new i.Notice(`EasyLink: Searching for "${e.trim()}"...`,0)},500);try{let a=e.trim();if(a.length<1){new i.Notice("Please select at least 1 character.");return}let c=new Set(a.toLowerCase().split(/\s+/).filter(d=>d.length>0&&!this.combinedStopwords.has(d)));if(c.size===0&&a.length>0){new i.Notice("Query contains only common words. Please try a more specific query.");return}let p=c.size>0?c:new Set(a.toLowerCase().split(/\s+/)),n=await this.keywordSearch(e,p),o=n.filter(d=>d.score>=this.settings.minScore);o.length>0?new T(this.app,this,o,t,e,p).open():n.length>0?new i.Notice("Found results, but they were below your minimum score setting."):new i.Notice("No similar content found.")}catch(a){console.error("EasyLink Search Error:",a)}finally{clearTimeout(r),s&&s.hide(),this.isSearching=!1}}async keywordSearch(e,t){let s=[],r=this.app.vault.getMarkdownFiles(),a=this.app.workspace.getActiveFile(),c=new Set(this.settings.foldersToIgnore.map(i.normalizePath));for(let n of r){if(!this.settings.searchCurrentFile&&a&&n.path===a.path||c.size>0&&Array.from(c).some(l=>(0,i.normalizePath)(n.path).startsWith(l)))continue;let o=this.app.metadataCache.getFileCache(n);if(!o)continue;let d=await this.app.vault.cachedRead(n),m=(l,g,f,S,C)=>{let E=new Set(l.toLowerCase().split(/\s+/).filter(w=>!this.combinedStopwords.has(w))),k=0;for(let w of t)E.has(w)&&k++;if(k>0){let w=k/t.size;s.push({file:n,content:S,score:w,type:g,linkTarget:f,position:C})}};if(o.headings)for(let l of o.headings){let g="#".repeat(l.level)+" "+l.heading;m(l.heading,"heading",l.heading,g)}if(o.sections)for(let l of o.sections){if(l.type==="heading")continue;let g=d.substring(l.position.start.offset,l.position.end.offset);if(g.trim().length>0){let f;if(o.blocks){for(let S in o.blocks)if(o.blocks[S].position.end.line===l.position.end.line){f=S;break}}m(g,"block",f?`^${f}`:"",g,f?void 0:l.position)}}}return s.sort((n,o)=>o.score-n.score),s.filter((n,o,d)=>o===d.findIndex(m=>m.file.path===n.file.path&&m.content===n.content)).slice(0,this.settings.maxResults)}},T=class extends i.FuzzySuggestModal{constructor(e,t,s,r,a,c){super(e);this.plugin=t;this.results=s;this.editor=r;this.originalSelection=a;this.queryWords=c}onOpen(){super.onOpen(),this.modalEl.addClass("easylink-preview-modal");let e=this.modalEl.createDiv({cls:"easylink-shortcut-hint"});e.innerHTML="Press <b>\u21B5 Enter</b> to insert link, or <b>Ctrl/Cmd + \u21B5 Enter</b> to open in a new tab.",this.scope.register(["Mod"],"Enter",t=>{let s=this.results[this.chooser.selectedItem];return s&&(this.openNoteInNewTab(s),this.close()),!1})}getItems(){return this.results}getItemText(e){return`${e.file.basename} ${e.content}`}renderSuggestion(e,t){t.empty(),t.addClass("easylink-result-item");let s=t.createDiv({cls:"easylink-result-header"}),r=s.createDiv({cls:"easylink-result-title"});e.item.file.parent&&!e.item.file.parent.isRoot()&&r.createSpan({text:e.item.file.parent.name+" / ",cls:"easylink-folder-path"}),r.createSpan({text:e.item.file.basename,cls:"easylink-file-name"});let a=s.createSpan({text:`${(e.item.score*100).toFixed(0)}%`,cls:"easylink-result-score"}),c=e.item.score;c>=.9?a.addClass("score-high"):c>=.7?a.addClass("score-medium"):c<.5&&a.addClass("score-low");let p=e.item.content;if(this.queryWords.size>0){let o=new RegExp(`(${Array.from(this.queryWords).join("|")})`,"gi");p=p.replace(o,"<mark>$1</mark>")}let n=t.createDiv({cls:"easylink-result-preview"});i.MarkdownRenderer.render(this.app,p,n,e.item.file.path,this.plugin)}async onChooseItem(e,t){t.ctrlKey||t.metaKey?await this.openNoteInNewTab(e):await this.insertLink(e)}generateBlockId(){return Math.random().toString(36).substring(2,8)}async ensureAndGetBlockId(e){if(e.linkTarget&&e.linkTarget.startsWith("^"))return e.linkTarget;let t=this.generateBlockId(),s=` ^${t}`,a=(await this.app.vault.read(e.file)).split(`
`),c=a[e.position.end.line],p={line:e.position.end.line,ch:c.length},n=this.app.workspace.activeEditor?.editor;return n&&n.getLine(0)===a[0]&&this.app.workspace.getActiveFile()?.path===e.file.path?n.replaceRange(s,p):await this.app.vault.process(e.file,o=>{let d=o.split(`
`);return d[e.position.end.line]+=s,d.join(`
`)}),`^${t}`}async buildLinkPath(e){let t=this.app.metadataCache.fileToLinktext(e.file,"",!0),s=e.linkTarget;return e.type==="block"&&!s&&(s=await this.ensureAndGetBlockId(e)),s?`${t}#${s}`:t}async insertLink(e){let s=`[[${await this.buildLinkPath(e)}|${this.originalSelection}]]`;this.editor.replaceSelection(s),new i.Notice(`Link to "${e.file.basename}" inserted.`)}async openNoteInNewTab(e){let t=await this.buildLinkPath(e);this.app.workspace.openLinkText(t,e.file.path,!0),new i.Notice(`Opened "${e.file.basename}" in a new tab.`)}},v=class extends i.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty(),new i.Setting(e).setHeading().setName("General"),new i.Setting(e).setName("Include current file in search").setDesc("If enabled, the currently active file will also be included in the search results.").addToggle(t=>t.setValue(this.plugin.settings.searchCurrentFile).onChange(async s=>{this.plugin.settings.searchCurrentFile=s,await this.plugin.saveSettings()})),new i.Setting(e).setName("Folders to ignore").setDesc('Prevent search in specific folders. Enter one folder path per line (e.g., "Meta/Templates").').addTextArea(t=>t.setPlaceholder(`Templates/
Attachments/`).setValue(this.plugin.settings.foldersToIgnore.join(`
`)).onChange(async s=>{this.plugin.settings.foldersToIgnore=s.split(`
`).map(r=>r.trim()).filter(r=>r.length>0),await this.plugin.saveSettings()})),new i.Setting(e).setName("Maximum results").setDesc("The maximum number of results to display in the search modal.").addSlider(t=>t.setLimits(5,100,5).setValue(this.plugin.settings.maxResults).setDynamicTooltip().onChange(async s=>{this.plugin.settings.maxResults=s,await this.plugin.saveSettings()})),new i.Setting(e).setName("Minimum score threshold").setDesc("Filter out results below this similarity score. A lower value will show more, less relevant results.").addSlider(t=>t.setLimits(0,100,1).setValue(this.plugin.settings.minScore*100).setDynamicTooltip().onChange(async s=>{this.plugin.settings.minScore=s/100,await this.plugin.saveSettings()})),new i.Setting(e).setHeading().setName("Keyword Search"),new i.Setting(e).setName("Use default stopwords").setDesc('If enabled, common words (like "the", "it", "is", "and") will be ignored during search for better relevance.').addToggle(t=>t.setValue(this.plugin.settings.useDefaultStopwords).onChange(async s=>{this.plugin.settings.useDefaultStopwords=s,await this.plugin.saveSettings()})),new i.Setting(e).setName("Custom stopwords").setDesc("Add your own words to ignore during keyword search. Enter one word per line.").addTextArea(t=>t.setPlaceholder(`project-x
internal-memo
etc`).setValue(this.plugin.settings.customStopwords.join(`
`)).onChange(async s=>{this.plugin.settings.customStopwords=s.split(`
`).map(r=>r.trim()).filter(r=>r.length>0),await this.plugin.saveSettings()})),new i.Setting(e).setHeading().setName("Support"),new i.Setting(e).setDesc("If you find EasyLink useful, please consider supporting its development!").addButton(t=>{t.setButtonText("Sponsor on GitHub \u2764\uFE0F").onClick(()=>{window.open("https://github.com/sponsors/isitwho","_blank")}),t.buttonEl.addClass("easylink-github-sponsor-button")}).addButton(t=>{t.setButtonText("Buy Me a Coffee \u2615").onClick(()=>{window.open("https://buymeacoffee.com/isitwho","_blank")}),t.buttonEl.addClass("easylink-bmac-button")})}};

/* nosourcemap */